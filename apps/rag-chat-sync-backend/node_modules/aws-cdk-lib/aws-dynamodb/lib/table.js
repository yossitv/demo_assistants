"use strict";var __runInitializers=exports&&exports.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=exports&&exports.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(f!==void 0&&typeof f!="function")throw new TypeError("Function expected");return f}for(var kind=contextIn.kind,key=kind==="getter"?"get":kind==="setter"?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),_,done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]=p==="access"?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])(kind==="accessor"?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if(kind==="accessor"){if(result===void 0)continue;if(result===null||typeof result!="object")throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&(kind==="field"?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Table=exports.TableBase=exports.ApproximateCreationDateTimePrecision=exports.InputFormat=exports.InputCompressionType=void 0;var jsiiDeprecationWarnings=()=>{var tmp=require("../../.warnings.jsii.js");return jsiiDeprecationWarnings=()=>tmp,tmp};const JSII_RTTI_SYMBOL_1=Symbol.for("jsii.rtti");var constructs_1=()=>{var tmp=require("constructs");return constructs_1=()=>tmp,tmp},dynamodb_canned_metrics_generated_1=()=>{var tmp=require("./dynamodb-canned-metrics.generated");return dynamodb_canned_metrics_generated_1=()=>tmp,tmp},dynamodb_generated_1=()=>{var tmp=require("./dynamodb.generated");return dynamodb_generated_1=()=>tmp,tmp},replica_provider_1=()=>{var tmp=require("./replica-provider");return replica_provider_1=()=>tmp,tmp},scalable_table_attribute_1=()=>{var tmp=require("./scalable-table-attribute");return scalable_table_attribute_1=()=>tmp,tmp},shared_1=()=>{var tmp=require("./shared");return shared_1=()=>tmp,tmp},stream_grants_1=()=>{var tmp=require("./stream-grants");return stream_grants_1=()=>tmp,tmp},table_grants_1=()=>{var tmp=require("./table-grants");return table_grants_1=()=>tmp,tmp},appscaling=()=>{var tmp=require("../../aws-applicationautoscaling");return appscaling=()=>tmp,tmp},cloudwatch=()=>{var tmp=require("../../aws-cloudwatch");return cloudwatch=()=>tmp,tmp},iam=()=>{var tmp=require("../../aws-iam");return iam=()=>tmp,tmp},kms=()=>{var tmp=require("../../aws-kms");return kms=()=>tmp,tmp},core_1=()=>{var tmp=require("../../core");return core_1=()=>tmp,tmp},errors_1=()=>{var tmp=require("../../core/lib/errors");return errors_1=()=>tmp,tmp},metadata_resource_1=()=>{var tmp=require("../../core/lib/metadata-resource");return metadata_resource_1=()=>tmp,tmp},prop_injectable_1=()=>{var tmp=require("../../core/lib/prop-injectable");return prop_injectable_1=()=>tmp,tmp},cx_api_1=()=>{var tmp=require("../../cx-api");return cx_api_1=()=>tmp,tmp};const HASH_KEY_TYPE="HASH",RANGE_KEY_TYPE="RANGE",MAX_LOCAL_SECONDARY_INDEX_COUNT=5;var InputCompressionType;(function(InputCompressionType2){InputCompressionType2.GZIP="GZIP",InputCompressionType2.ZSTD="ZSTD",InputCompressionType2.NONE="NONE"})(InputCompressionType||(exports.InputCompressionType=InputCompressionType={}));class InputFormat{static[JSII_RTTI_SYMBOL_1]={fqn:"aws-cdk-lib.aws_dynamodb.InputFormat",version:"2.230.0"};static dynamoDBJson(){return new class extends InputFormat{_render(){return{inputFormat:"DYNAMODB_JSON"}}}}static ion(){return new class extends InputFormat{_render(){return{inputFormat:"ION"}}}}static csv(options){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_CsvOptions(options)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.csv),error}if(options?.delimiter&&(!this.validCsvDelimiters.includes(options.delimiter)||options.delimiter.length!==1))throw new(errors_1()).UnscopedValidationError(["Delimiter must be a single character and one of the following:",`${this.readableValidCsvDelimiters.join(", ")},`,`got '${options.delimiter}'`].join(" "));return new class extends InputFormat{_render(){return{inputFormat:"CSV",inputFormatOptions:{csv:{delimiter:options?.delimiter,headerList:options?.headerList}}}}}}static validCsvDelimiters=[",","	",":",";","|"," "];static readableValidCsvDelimiters=["comma (,)","tab (\\t)","colon (:)","semicolon (;)","pipe (|)","space ( )"]}exports.InputFormat=InputFormat;var ApproximateCreationDateTimePrecision;(function(ApproximateCreationDateTimePrecision2){ApproximateCreationDateTimePrecision2.MILLISECOND="MILLISECOND",ApproximateCreationDateTimePrecision2.MICROSECOND="MICROSECOND"})(ApproximateCreationDateTimePrecision||(exports.ApproximateCreationDateTimePrecision=ApproximateCreationDateTimePrecision={}));class TableBase extends core_1().Resource{static[JSII_RTTI_SYMBOL_1]={fqn:"aws-cdk-lib.aws_dynamodb.TableBase",version:"2.230.0"};regionalArns=new Array;grantOnKey(grantee,...actions){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantOnKey),error}return{grant:this.encryptionKey?.grant(grantee,...actions)}}get tableRef(){return{tableArn:this.tableArn,tableName:this.tableName}}get grants(){return new(table_grants_1()).TableGrants({table:this,encryptedResource:this,policyResource:this,regions:this.regions,hasIndex:this.hasIndex})}get streamGrants(){if(!this.tableStreamArn)throw new(errors_1()).ValidationError(`DynamoDB Streams must be enabled on the table ${this.node.path}`,this);return new(stream_grants_1()).StreamGrants({table:this,tableStreamArn:this.tableStreamArn,encryptionKey:this.encryptionKey})}grant(grantee,...actions){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grant),error}return this.grants.actions(grantee,...actions)}grantStream(grantee,...actions){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantStream),error}return this.streamGrants.actions(grantee,...actions)}grantReadData(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantReadData),error}return this.grants.readData(grantee)}grantTableListStreams(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantTableListStreams),error}return this.streamGrants.list(grantee)}grantStreamRead(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantStreamRead),error}return this.streamGrants.read(grantee)}grantWriteData(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantWriteData),error}return this.grants.writeData(grantee)}grantReadWriteData(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantReadWriteData),error}return this.grants.readWriteData(grantee)}grantFullAccess(grantee){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_IGrantable(grantee)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.grantFullAccess),error}return this.grants.fullAccess(grantee)}metric(metricName,props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metric),error}return new(cloudwatch()).Metric({namespace:"AWS/DynamoDB",metricName,dimensionsMap:{TableName:this.tableName},...props}).attachTo(this)}metricConsumedReadCapacityUnits(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricConsumedReadCapacityUnits),error}return this.cannedMetric(dynamodb_canned_metrics_generated_1().DynamoDBMetrics.consumedReadCapacityUnitsSum,props)}metricConsumedWriteCapacityUnits(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricConsumedWriteCapacityUnits),error}return this.cannedMetric(dynamodb_canned_metrics_generated_1().DynamoDBMetrics.consumedWriteCapacityUnitsSum,props)}metricSystemErrors(props){try{jsiiDeprecationWarnings().print("aws-cdk-lib.aws_dynamodb.TableBase#metricSystemErrors","use `metricSystemErrorsForOperations`."),jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricSystemErrors),error}if(!props?.dimensions?.Operation&&!props?.dimensionsMap?.Operation)throw new(errors_1()).ValidationError("'Operation' dimension must be passed for the 'SystemErrors' metric.",this);const dimensionsMap={TableName:this.tableName,...props?.dimensions??{},...props?.dimensionsMap??{}};return this.metric("SystemErrors",{statistic:"sum",...props,dimensionsMap})}metricUserErrors(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricUserErrors),error}if(props?.dimensions)throw new(errors_1()).ValidationError("'dimensions' is not supported for the 'UserErrors' metric",this);return this.metric("UserErrors",{statistic:"sum",...props,dimensionsMap:{}})}metricConditionalCheckFailedRequests(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricConditionalCheckFailedRequests),error}return this.metric("ConditionalCheckFailedRequests",{statistic:"sum",...props})}metricThrottledRequests(props){try{jsiiDeprecationWarnings().print("aws-cdk-lib.aws_dynamodb.TableBase#metricThrottledRequests","Do not use this function. It returns an invalid metric. Use `metricThrottledRequestsForOperation` instead."),jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricThrottledRequests),error}return this.metric("ThrottledRequests",{statistic:"sum",...props})}metricSuccessfulRequestLatency(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricSuccessfulRequestLatency),error}if(!props?.dimensions?.Operation&&!props?.dimensionsMap?.Operation)throw new(errors_1()).ValidationError("'Operation' dimension must be passed for the 'SuccessfulRequestLatency' metric.",this);const dimensionsMap={TableName:this.tableName,Operation:props.dimensionsMap?.Operation??props.dimensions?.Operation};return new(cloudwatch()).Metric({...dynamodb_canned_metrics_generated_1().DynamoDBMetrics.successfulRequestLatencyAverage(dimensionsMap),...props,dimensionsMap}).attachTo(this)}metricThrottledRequestsForOperation(operation,props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_cloudwatch_MetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricThrottledRequestsForOperation),error}return new(cloudwatch()).Metric({...dynamodb_canned_metrics_generated_1().DynamoDBMetrics.throttledRequestsSum({Operation:operation,TableName:this.tableName}),...props}).attachTo(this)}metricThrottledRequestsForOperations(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_OperationsMetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricThrottledRequestsForOperations),error}return this.sumMetricsForOperations("ThrottledRequests","Sum of throttled requests across all operations",props)}metricSystemErrorsForOperations(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_SystemErrorsForOperationsMetricOptions(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.metricSystemErrorsForOperations),error}return this.sumMetricsForOperations("SystemErrors","Sum of errors across all operations",props)}sumMetricsForOperations(metricName,expressionLabel,props){if(props?.dimensions?.Operation)throw new(errors_1()).ValidationError("The Operation dimension is not supported. Use the 'operations' property.",this);const operations=props?.operations??Object.values(shared_1().Operation),values=this.createMetricsForOperations(metricName,operations,{statistic:"sum",...props});return new(cloudwatch()).MathExpression({expression:`${Object.keys(values).join(" + ")}`,usingMetrics:{...values},color:props?.color,label:expressionLabel,period:props?.period})}createMetricsForOperations(metricName,operations,props,metricNameMapper){const metrics={},mapper=metricNameMapper??(op=>op.toLowerCase());if(props?.dimensions?.Operation)throw new(errors_1()).ValidationError("Invalid properties. Operation dimension is not supported when calculating operational metrics",this);for(const operation of operations){const metric=this.metric(metricName,{...props,dimensionsMap:{TableName:this.tableName,Operation:operation,...props?.dimensions}}),operationMetricName=mapper(operation),firstChar=operationMetricName.charAt(0);if(firstChar===firstChar.toUpperCase())throw new(errors_1()).ValidationError(`Mapper generated an illegal operation metric name: ${operationMetricName}. Must start with a lowercase letter`,this);metrics[operationMetricName]=metric}return metrics}cannedMetric(fn,props){return new(cloudwatch()).Metric({...fn({TableName:this.tableName}),...props}).attachTo(this)}}exports.TableBase=TableBase;let Table=(()=>{let _classDecorators=[prop_injectable_1().propertyInjectable],_classDescriptor,_classExtraInitializers=[],_classThis,_classSuper=TableBase,_instanceExtraInitializers=[],_addToResourcePolicy_decorators,_addGlobalSecondaryIndex_decorators,_addLocalSecondaryIndex_decorators,_autoScaleReadCapacity_decorators,_autoScaleWriteCapacity_decorators,_autoScaleGlobalSecondaryIndexReadCapacity_decorators,_autoScaleGlobalSecondaryIndexWriteCapacity_decorators,_schema_decorators,_schemaV2_decorators;var Table2=class extends _classSuper{static{_classThis=this}static{const _metadata=typeof Symbol=="function"&&Symbol.metadata?Object.create(_classSuper[Symbol.metadata]??null):void 0;_addToResourcePolicy_decorators=[(0,metadata_resource_1().MethodMetadata)()],_addGlobalSecondaryIndex_decorators=[(0,metadata_resource_1().MethodMetadata)()],_addLocalSecondaryIndex_decorators=[(0,metadata_resource_1().MethodMetadata)()],_autoScaleReadCapacity_decorators=[(0,metadata_resource_1().MethodMetadata)()],_autoScaleWriteCapacity_decorators=[(0,metadata_resource_1().MethodMetadata)()],_autoScaleGlobalSecondaryIndexReadCapacity_decorators=[(0,metadata_resource_1().MethodMetadata)()],_autoScaleGlobalSecondaryIndexWriteCapacity_decorators=[(0,metadata_resource_1().MethodMetadata)()],_schema_decorators=[(0,metadata_resource_1().MethodMetadata)()],_schemaV2_decorators=[(0,metadata_resource_1().MethodMetadata)()],__esDecorate(this,null,_addToResourcePolicy_decorators,{kind:"method",name:"addToResourcePolicy",static:!1,private:!1,access:{has:obj=>"addToResourcePolicy"in obj,get:obj=>obj.addToResourcePolicy},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_addGlobalSecondaryIndex_decorators,{kind:"method",name:"addGlobalSecondaryIndex",static:!1,private:!1,access:{has:obj=>"addGlobalSecondaryIndex"in obj,get:obj=>obj.addGlobalSecondaryIndex},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_addLocalSecondaryIndex_decorators,{kind:"method",name:"addLocalSecondaryIndex",static:!1,private:!1,access:{has:obj=>"addLocalSecondaryIndex"in obj,get:obj=>obj.addLocalSecondaryIndex},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_autoScaleReadCapacity_decorators,{kind:"method",name:"autoScaleReadCapacity",static:!1,private:!1,access:{has:obj=>"autoScaleReadCapacity"in obj,get:obj=>obj.autoScaleReadCapacity},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_autoScaleWriteCapacity_decorators,{kind:"method",name:"autoScaleWriteCapacity",static:!1,private:!1,access:{has:obj=>"autoScaleWriteCapacity"in obj,get:obj=>obj.autoScaleWriteCapacity},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_autoScaleGlobalSecondaryIndexReadCapacity_decorators,{kind:"method",name:"autoScaleGlobalSecondaryIndexReadCapacity",static:!1,private:!1,access:{has:obj=>"autoScaleGlobalSecondaryIndexReadCapacity"in obj,get:obj=>obj.autoScaleGlobalSecondaryIndexReadCapacity},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_autoScaleGlobalSecondaryIndexWriteCapacity_decorators,{kind:"method",name:"autoScaleGlobalSecondaryIndexWriteCapacity",static:!1,private:!1,access:{has:obj=>"autoScaleGlobalSecondaryIndexWriteCapacity"in obj,get:obj=>obj.autoScaleGlobalSecondaryIndexWriteCapacity},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_schema_decorators,{kind:"method",name:"schema",static:!1,private:!1,access:{has:obj=>"schema"in obj,get:obj=>obj.schema},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,_schemaV2_decorators,{kind:"method",name:"schemaV2",static:!1,private:!1,access:{has:obj=>"schemaV2"in obj,get:obj=>obj.schemaV2},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(null,_classDescriptor={value:_classThis},_classDecorators,{kind:"class",name:_classThis.name,metadata:_metadata},null,_classExtraInitializers),Table2=_classThis=_classDescriptor.value,_metadata&&Object.defineProperty(_classThis,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}static[JSII_RTTI_SYMBOL_1]={fqn:"aws-cdk-lib.aws_dynamodb.Table",version:"2.230.0"};static PROPERTY_INJECTION_ID="aws-cdk-lib.aws-dynamodb.Table";static grantListStreams(grantee){return iam().Grant.addToPrincipal({grantee,actions:["dynamodb:ListStreams"],resourceArns:["*"]})}static fromTableName(scope,id,tableName){return Table2.fromTableAttributes(scope,id,{tableName})}static fromTableArn(scope,id,tableArn){return Table2.fromTableAttributes(scope,id,{tableArn})}static fromTableAttributes(scope,id,attrs){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_TableAttributes(attrs)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.fromTableAttributes),error}class Import extends TableBase{tableName;tableArn;tableStreamArn;encryptionKey;resourcePolicy;hasIndex=(attrs.grantIndexPermissions??!1)||(attrs.globalIndexes??[]).length>0||(attrs.localIndexes??[]).length>0;regions=[];constructor(_tableArn,tableName,tableStreamArn){super(scope,id),this.tableArn=_tableArn,this.tableName=tableName,this.tableStreamArn=tableStreamArn,this.encryptionKey=attrs.encryptionKey}addToResourcePolicy(_statement){return{statementAdded:!1}}}let name,arn;const stack=core_1().Stack.of(scope);if(attrs.tableName){if(attrs.tableArn)throw new(errors_1()).ValidationError("Only one of tableArn or tableName can be provided",scope);name=attrs.tableName,arn=stack.formatArn({service:"dynamodb",resource:"table",resourceName:attrs.tableName})}else{if(!attrs.tableArn)throw new(errors_1()).ValidationError("One of tableName or tableArn is required!",scope);arn=attrs.tableArn;const maybeTableName=stack.splitArn(attrs.tableArn,core_1().ArnFormat.SLASH_RESOURCE_NAME).resourceName;if(!maybeTableName)throw new(errors_1()).ValidationError("ARN for DynamoDB table must be in the form: ...",scope);name=maybeTableName}return new Import(arn,name,attrs.tableStreamArn)}encryptionKey=__runInitializers(this,_instanceExtraInitializers);resourcePolicy;tableArn;tableName;tableStreamArn;table;keySchema=new Array;attributeDefinitions=new Array;globalSecondaryIndexes=new Array;localSecondaryIndexes=new Array;schemas=new Map;nonKeyAttributes=new Set;tablePartitionKey;tableSortKey;billingMode;tableScaling={};indexScaling=new Map;scalingRole;globalReplicaCustomResources=new Array;regions=new Array;constructor(scope,id,props){super(scope,id,{physicalName:props.tableName});try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_TableProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,Table2),error}if(!props?.partitionKey)throw new(errors_1()).ValidationError("partitionKey is required for Table",this);const normalizedSchema=(0,shared_1().parseKeySchema)(props,this);this.schemas.set(SPECIAL_TABLE_SCHEMA_NAME,normalizedSchema),(0,metadata_resource_1().addConstructMetadata)(this,props),this.resourcePolicy=props.resourcePolicy;const{sseSpecification,encryptionKey}=this.parseEncryption(props),pointInTimeRecoverySpecification=this.validatePitr(props),contributorInsightsSpecification=this.validateCCI(props);let streamSpecification;if(props.replicationRegions){if(props.stream&&props.stream!==shared_1().StreamViewType.NEW_AND_OLD_IMAGES)throw new(errors_1()).ValidationError("`stream` must be set to `NEW_AND_OLD_IMAGES` when specifying `replicationRegions`",this);streamSpecification={streamViewType:shared_1().StreamViewType.NEW_AND_OLD_IMAGES},this.billingMode=props.billingMode??shared_1().BillingMode.PAY_PER_REQUEST}else this.billingMode=props.billingMode??shared_1().BillingMode.PROVISIONED,props.stream&&(streamSpecification={streamViewType:props.stream});this.validateProvisioning(props);const kinesisStreamSpecification=props.kinesisStream?{streamArn:props.kinesisStream.streamArn,...props.kinesisPrecisionTimestamp&&{approximateCreationDateTimePrecision:props.kinesisPrecisionTimestamp}}:void 0;this.table=new(dynamodb_generated_1()).CfnTable(this,"Resource",{tableName:this.physicalName,keySchema:this.keySchema,attributeDefinitions:this.attributeDefinitions,globalSecondaryIndexes:core_1().Lazy.any({produce:()=>this.globalSecondaryIndexes},{omitEmptyArray:!0}),localSecondaryIndexes:core_1().Lazy.any({produce:()=>this.localSecondaryIndexes},{omitEmptyArray:!0}),pointInTimeRecoverySpecification,billingMode:this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST?this.billingMode:void 0,provisionedThroughput:this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST?void 0:{readCapacityUnits:props.readCapacity||5,writeCapacityUnits:props.writeCapacity||5},...props.maxReadRequestUnits||props.maxWriteRequestUnits?{onDemandThroughput:this.billingMode===shared_1().BillingMode.PROVISIONED?void 0:{maxReadRequestUnits:props.maxReadRequestUnits||void 0,maxWriteRequestUnits:props.maxWriteRequestUnits||void 0}}:void 0,sseSpecification,streamSpecification,tableClass:props.tableClass,timeToLiveSpecification:props.timeToLiveAttribute?{attributeName:props.timeToLiveAttribute,enabled:!0}:void 0,contributorInsightsSpecification,kinesisStreamSpecification,deletionProtectionEnabled:props.deletionProtection,importSourceSpecification:this.renderImportSourceSpecification(props.importSource),warmThroughput:props.warmThroughput??void 0}),this.table.applyRemovalPolicy(props.removalPolicy),this.resourcePolicy&&(this.table.resourcePolicy={policyDocument:this.resourcePolicy}),this.encryptionKey=encryptionKey,this.tableArn=this.getResourceArnAttribute(this.table.attrArn,{service:"dynamodb",resource:"table",resourceName:this.physicalName}),this.tableName=this.getResourceNameAttribute(this.table.ref),props.tableName&&this.node.addMetadata("aws:cdk:hasPhysicalName",this.tableName),this.tableStreamArn=streamSpecification?this.table.attrStreamArn:void 0,this.scalingRole=this.makeScalingRole(),this.addKey(props.partitionKey,HASH_KEY_TYPE),this.tablePartitionKey=props.partitionKey,props.sortKey&&(this.addKey(props.sortKey,RANGE_KEY_TYPE),this.tableSortKey=props.sortKey),props.replicationRegions&&props.replicationRegions.length>0&&this.createReplicaTables(props.replicationRegions,props.replicationTimeout,props.waitForReplicationToFinish,props.replicaRemovalPolicy),this.node.addValidation({validate:()=>this.validateTable()})}addToResourcePolicy(statement){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_iam_PolicyStatement(statement)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.addToResourcePolicy),error}return this.resourcePolicy=this.resourcePolicy??new(iam()).PolicyDocument({statements:[]}),this.resourcePolicy.addStatements(statement),this.table.resourcePolicy={policyDocument:this.resourcePolicy},{statementAdded:!0,policyDependable:this}}addGlobalSecondaryIndex(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_GlobalSecondaryIndexProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.addGlobalSecondaryIndex),error}this.validateProvisioning(props),this.validateIndexName(props.indexName);const normalizedSchema=(0,shared_1().parseKeySchema)(props,this),contributorInsightsSpecification=this.validateCCI(props);this.globalSecondaryIndexes.push({contributorInsightsSpecification,indexName:props.indexName,keySchema:this.buildIndexKeySchema(normalizedSchema),projection:this.buildIndexProjection(props),provisionedThroughput:this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST?void 0:{readCapacityUnits:props.readCapacity||5,writeCapacityUnits:props.writeCapacity||5},...props.maxReadRequestUnits||props.maxWriteRequestUnits?{onDemandThroughput:this.billingMode===shared_1().BillingMode.PROVISIONED?void 0:{maxReadRequestUnits:props.maxReadRequestUnits||void 0,maxWriteRequestUnits:props.maxWriteRequestUnits||void 0}}:void 0,warmThroughput:props.warmThroughput??void 0}),this.schemas.set(props.indexName,normalizedSchema),this.indexScaling.set(props.indexName,{})}addLocalSecondaryIndex(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_LocalSecondaryIndexProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.addLocalSecondaryIndex),error}if(this.localSecondaryIndexes.length>=MAX_LOCAL_SECONDARY_INDEX_COUNT)throw new RangeError(`a maximum number of local secondary index per table is ${MAX_LOCAL_SECONDARY_INDEX_COUNT}`);const normalizedSchema=(0,shared_1().parseKeySchema)({...props,partitionKey:this.tablePartitionKey,partitionKeys:void 0},this);this.validateIndexName(props.indexName),this.localSecondaryIndexes.push({indexName:props.indexName,keySchema:this.buildIndexKeySchema(normalizedSchema),projection:this.buildIndexProjection(props)}),this.schemas.set(props.indexName,normalizedSchema)}autoScaleReadCapacity(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_EnableScalingProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.autoScaleReadCapacity),error}if(this.tableScaling.scalableReadAttribute)throw new(errors_1()).ValidationError("Read AutoScaling already enabled for this table",this);if(this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST)throw new(errors_1()).ValidationError("AutoScaling is not available for tables with PAY_PER_REQUEST billing mode",this);return this.tableScaling.scalableReadAttribute=new(scalable_table_attribute_1()).ScalableTableAttribute(this,"ReadScaling",{serviceNamespace:appscaling().ServiceNamespace.DYNAMODB,resourceId:`table/${this.tableName}`,dimension:"dynamodb:table:ReadCapacityUnits",role:this.scalingRole,...props})}autoScaleWriteCapacity(props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_EnableScalingProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.autoScaleWriteCapacity),error}if(this.tableScaling.scalableWriteAttribute)throw new(errors_1()).ValidationError("Write AutoScaling already enabled for this table",this);if(this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST)throw new(errors_1()).ValidationError("AutoScaling is not available for tables with PAY_PER_REQUEST billing mode",this);this.tableScaling.scalableWriteAttribute=new(scalable_table_attribute_1()).ScalableTableAttribute(this,"WriteScaling",{serviceNamespace:appscaling().ServiceNamespace.DYNAMODB,resourceId:`table/${this.tableName}`,dimension:"dynamodb:table:WriteCapacityUnits",role:this.scalingRole,...props});for(const globalReplicaCustomResource of this.globalReplicaCustomResources)globalReplicaCustomResource.node.addDependency(this.tableScaling.scalableWriteAttribute);return this.tableScaling.scalableWriteAttribute}autoScaleGlobalSecondaryIndexReadCapacity(indexName,props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_EnableScalingProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.autoScaleGlobalSecondaryIndexReadCapacity),error}if(this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST)throw new(errors_1()).ValidationError("AutoScaling is not available for tables with PAY_PER_REQUEST billing mode",this);const attributePair=this.indexScaling.get(indexName);if(!attributePair)throw new(errors_1()).ValidationError(`No global secondary index with name ${indexName}`,this);if(attributePair.scalableReadAttribute)throw new(errors_1()).ValidationError("Read AutoScaling already enabled for this index",this);return attributePair.scalableReadAttribute=new(scalable_table_attribute_1()).ScalableTableAttribute(this,`${indexName}ReadScaling`,{serviceNamespace:appscaling().ServiceNamespace.DYNAMODB,resourceId:`table/${this.tableName}/index/${indexName}`,dimension:"dynamodb:index:ReadCapacityUnits",role:this.scalingRole,...props})}autoScaleGlobalSecondaryIndexWriteCapacity(indexName,props){try{jsiiDeprecationWarnings().aws_cdk_lib_aws_dynamodb_EnableScalingProps(props)}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.autoScaleGlobalSecondaryIndexWriteCapacity),error}if(this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST)throw new(errors_1()).ValidationError("AutoScaling is not available for tables with PAY_PER_REQUEST billing mode",this);const attributePair=this.indexScaling.get(indexName);if(!attributePair)throw new(errors_1()).ValidationError(`No global secondary index with name ${indexName}`,this);if(attributePair.scalableWriteAttribute)throw new(errors_1()).ValidationError("Write AutoScaling already enabled for this index",this);return attributePair.scalableWriteAttribute=new(scalable_table_attribute_1()).ScalableTableAttribute(this,`${indexName}WriteScaling`,{serviceNamespace:appscaling().ServiceNamespace.DYNAMODB,resourceId:`table/${this.tableName}/index/${indexName}`,dimension:"dynamodb:index:WriteCapacityUnits",role:this.scalingRole,...props})}schema(indexName){try{jsiiDeprecationWarnings().print("aws-cdk-lib.aws_dynamodb.Table#schema","- use `schemaV2()` instead")}catch(error){throw process.env.JSII_DEBUG!=="1"&&error.name==="DeprecationError"&&Error.captureStackTrace(error,this.schema),error}let schema=this.schemas.get(indexName??SPECIAL_TABLE_SCHEMA_NAME);if(!schema)throw new(errors_1()).ValidationError(`Cannot find schema for index: ${indexName}. Use 'addGlobalSecondaryIndex' or 'addLocalSecondaryIndex' to add index`,this);if(schema.partitionKeys.length>1||schema.sortKeys.length>1)throw new(errors_1()).ValidationError(`Index ${indexName} uses compound keys and cannot be returned by schema(), use schemaV2() instead.`,this);return{partitionKey:schema.partitionKeys[0],sortKey:schema.sortKeys[0]}}schemaV2(indexName){let schema=this.schemas.get(indexName??SPECIAL_TABLE_SCHEMA_NAME);if(!schema)throw new(errors_1()).ValidationError(`Cannot find schema for index: ${indexName}. Use 'addGlobalSecondaryIndex' or 'addLocalSecondaryIndex' to add index`,this);return schema}validateTable(){const errors=new Array;if(this.tablePartitionKey||errors.push("a partition key must be specified"),this.localSecondaryIndexes.length>0&&!this.tableSortKey&&errors.push("a sort key of the table must be specified to add local secondary indexes"),this.globalReplicaCustomResources.length>0&&this.billingMode===shared_1().BillingMode.PROVISIONED){const writeAutoScaleAttribute=this.tableScaling.scalableWriteAttribute;writeAutoScaleAttribute?writeAutoScaleAttribute._scalingPolicyCreated||errors.push("A global Table that uses PROVISIONED as the billing mode needs auto-scaled write capacity with a policy. Call one of the scaleOn*() methods of the object returned from autoScaleWriteCapacity()"):errors.push("A global Table that uses PROVISIONED as the billing mode needs auto-scaled write capacity. Use the autoScaleWriteCapacity() method to enable it.")}return errors}validateProvisioning(props){if(this.billingMode===shared_1().BillingMode.PAY_PER_REQUEST&&(props.readCapacity!==void 0||props.writeCapacity!==void 0))throw new(errors_1()).ValidationError("you cannot provision read and write capacity for a table with PAY_PER_REQUEST billing mode",this)}validateIndexName(indexName){if(this.schemas.has(indexName))throw new(errors_1()).ValidationError(`a duplicate index name, ${indexName}, is not allowed`,this)}validateNonKeyAttributes(nonKeyAttributes){if(this.nonKeyAttributes.size+nonKeyAttributes.length>100)throw new RangeError("a maximum number of nonKeyAttributes across all of secondary indexes is 100");nonKeyAttributes.forEach(att=>this.nonKeyAttributes.add(att))}validatePitr(props){if(props.pointInTimeRecoverySpecification!==void 0&&props.pointInTimeRecovery!==void 0)throw new(errors_1()).ValidationError("`pointInTimeRecoverySpecification` and `pointInTimeRecovery` are set. Use `pointInTimeRecoverySpecification` only.",this);const recoveryPeriodInDays=props.pointInTimeRecoverySpecification?.recoveryPeriodInDays;if(!props.pointInTimeRecoverySpecification?.pointInTimeRecoveryEnabled&&recoveryPeriodInDays)throw new(errors_1()).ValidationError("Cannot set `recoveryPeriodInDays` while `pointInTimeRecoveryEnabled` is set to false.",this);if(recoveryPeriodInDays!==void 0&&(recoveryPeriodInDays<1||recoveryPeriodInDays>35))throw new(errors_1()).ValidationError("`recoveryPeriodInDays` must be a value between `1` and `35`.",this);return props.pointInTimeRecoverySpecification??(props.pointInTimeRecovery!==void 0?{pointInTimeRecoveryEnabled:props.pointInTimeRecovery}:void 0)}validateCCI(props){return(0,shared_1().validateContributorInsights)(props.contributorInsightsEnabled,props.contributorInsightsSpecification,"contributorInsightsEnabled",this)}buildIndexKeySchema(keySchema){for(const attr of[...keySchema.partitionKeys,...keySchema.sortKeys])this.registerAttribute(attr);return[...keySchema.partitionKeys.map(pk=>({attributeName:pk.name,keyType:HASH_KEY_TYPE})),...keySchema.sortKeys.map(sk=>({attributeName:sk.name,keyType:RANGE_KEY_TYPE}))]}buildIndexProjection(props){if(props.projectionType===shared_1().ProjectionType.INCLUDE&&!props.nonKeyAttributes)throw new(errors_1()).ValidationError(`non-key attributes should be specified when using ${shared_1().ProjectionType.INCLUDE} projection type`,this);if(props.projectionType!==shared_1().ProjectionType.INCLUDE&&props.nonKeyAttributes)throw new(errors_1()).ValidationError(`non-key attributes should not be specified when not using ${shared_1().ProjectionType.INCLUDE} projection type`,this);return props.nonKeyAttributes&&this.validateNonKeyAttributes(props.nonKeyAttributes),{projectionType:props.projectionType??shared_1().ProjectionType.ALL,nonKeyAttributes:props.nonKeyAttributes??void 0}}findKey(keyType){return this.keySchema.find(prop=>prop.keyType===keyType)}addKey(attribute,keyType){const existingProp=this.findKey(keyType);if(existingProp)throw new(errors_1()).ValidationError(`Unable to set ${attribute.name} as a ${keyType} key, because ${existingProp.attributeName} is a ${keyType} key`,this);return this.registerAttribute(attribute),this.keySchema.push({attributeName:attribute.name,keyType}),this}registerAttribute(attribute){const{name,type}=attribute,existingDef=this.attributeDefinitions.find(def=>def.attributeName===name);if(existingDef&&existingDef.attributeType!==type)throw new(errors_1()).ValidationError(`Unable to specify ${name} as ${type} because it was already defined as ${existingDef.attributeType}`,this);existingDef||this.attributeDefinitions.push({attributeName:name,attributeType:type})}makeScalingRole(){return iam().Role.fromRoleArn(this,"ScalingRole",core_1().Stack.of(this).formatArn({service:"iam",region:"",resource:"role/aws-service-role/dynamodb.application-autoscaling.amazonaws.com",resourceName:"AWSServiceRoleForApplicationAutoScaling_DynamoDBTable"}))}createReplicaTables(regions,timeout,waitForReplicationToFinish,replicaRemovalPolicy){const stack=core_1().Stack.of(this);if(!core_1().Token.isUnresolved(stack.region)&&regions.includes(stack.region))throw new(errors_1()).ValidationError("`replicationRegions` cannot include the region where this stack is deployed.",this);const provider=replica_provider_1().ReplicaProvider.getOrCreate(this,{tableName:this.tableName,regions,timeout}),onEventHandlerPolicy=new SourceTableAttachedPolicy(this,provider.onEventHandler.role),isCompleteHandlerPolicy=new SourceTableAttachedPolicy(this,provider.isCompleteHandler.role);onEventHandlerPolicy.policy.addStatements(new(iam()).PolicyStatement({actions:["dynamodb:*"],resources:[this.tableArn,core_1().Lazy.string({produce:()=>this.hasIndex?`${this.tableArn}/index/*`:core_1().Aws.NO_VALUE}),...this.regionalArns,...this.regionalArns.map(arn=>core_1().Lazy.string({produce:()=>this.hasIndex?`${arn}/index/*`:core_1().Aws.NO_VALUE}))]})),isCompleteHandlerPolicy.policy.addStatements(new(iam()).PolicyStatement({actions:["dynamodb:DescribeTable"],resources:[this.tableArn,core_1().Lazy.string({produce:()=>this.hasIndex?`${this.tableArn}/index/*`:core_1().Aws.NO_VALUE}),...this.regionalArns,...this.regionalArns.map(arn=>core_1().Lazy.string({produce:()=>this.hasIndex?`${arn}/index/*`:core_1().Aws.NO_VALUE}))]}));let previousRegion,previousRegionCondition;const skipReplicaDeletion=core_1().FeatureFlags.of(this).isEnabled(cx_api_1().DYNAMODB_TABLE_RETAIN_TABLE_REPLICA)?core_1().Lazy.any({produce:()=>replicaRemovalPolicy?replicaRemovalPolicy==core_1().RemovalPolicy.RETAIN:this.node.defaultChild.cfnOptions.deletionPolicy===core_1().CfnDeletionPolicy.RETAIN}):!1;for(const region of new Set(regions)){const currentRegion=new(core_1()).CustomResource(this,`Replica${region}`,{serviceToken:provider.provider.serviceToken,resourceType:"Custom::DynamoDBReplica",properties:{TableName:this.tableName,Region:region,...skipReplicaDeletion&&{SkipReplicaDeletion:skipReplicaDeletion},SkipReplicationCompletedWait:waitForReplicationToFinish==null?void 0:(!waitForReplicationToFinish).toString()}});currentRegion.node.addDependency(onEventHandlerPolicy.policy,isCompleteHandlerPolicy.policy),this.globalReplicaCustomResources.push(currentRegion);let createReplica;if(core_1().Token.isUnresolved(stack.region)){createReplica=new(core_1()).CfnCondition(this,`StackRegionNotEquals${region}`,{expression:core_1().Fn.conditionNot(core_1().Fn.conditionEquals(region,core_1().Aws.REGION))});const cfnCustomResource=currentRegion.node.defaultChild;cfnCustomResource.cfnOptions.condition=createReplica}if(this.regions?.push(region),this.regionalArns.push(stack.formatArn({region,service:"dynamodb",resource:"table",resourceName:this.tableName})),previousRegion)if(previousRegionCondition){const previousRegionCfnResource=previousRegion.node.defaultChild;currentRegion.node.defaultChild.addMetadata("DynamoDbReplicationDependency",core_1().Fn.conditionIf(previousRegionCondition.logicalId,previousRegionCfnResource.ref,core_1().Aws.NO_VALUE))}else currentRegion.node.addDependency(previousRegion);previousRegion=currentRegion,previousRegionCondition=createReplica}onEventHandlerPolicy.grantPrincipal.addToPrincipalPolicy(new(iam()).PolicyStatement({actions:["dynamodb:*"],resources:this.regionalArns}))}get hasIndex(){return this.globalSecondaryIndexes.length+this.localSecondaryIndexes.length>0}parseEncryption(props){let encryptionType=props.encryption;if(encryptionType!=null&&props.serverSideEncryption!=null)throw new(errors_1()).ValidationError("Only one of encryption and serverSideEncryption can be specified, but both were provided",this);if(props.serverSideEncryption&&props.encryptionKey)throw new(errors_1()).ValidationError("encryptionKey cannot be specified when serverSideEncryption is specified. Use encryption instead",this);if(encryptionType===void 0&&(encryptionType=props.encryptionKey!=null?shared_1().TableEncryption.CUSTOMER_MANAGED:props.serverSideEncryption?shared_1().TableEncryption.AWS_MANAGED:void 0),encryptionType!==shared_1().TableEncryption.CUSTOMER_MANAGED&&props.encryptionKey)throw new(errors_1()).ValidationError(`encryptionKey cannot be specified unless encryption is set to TableEncryption.CUSTOMER_MANAGED (it was set to ${encryptionType})`,this);if(encryptionType===shared_1().TableEncryption.CUSTOMER_MANAGED&&props.replicationRegions)throw new(errors_1()).ValidationError("TableEncryption.CUSTOMER_MANAGED is not supported by DynamoDB Global Tables (where replicationRegions was set)",this);switch(encryptionType){case shared_1().TableEncryption.CUSTOMER_MANAGED:const encryptionKey=props.encryptionKey??new(kms()).Key(this,"Key",{description:`Customer-managed key auto-created for encrypting DynamoDB table at ${this.node.path}`,enableKeyRotation:!0});return{sseSpecification:{sseEnabled:!0,kmsMasterKeyId:encryptionKey.keyArn,sseType:"KMS"},encryptionKey};case shared_1().TableEncryption.AWS_MANAGED:return{sseSpecification:{sseEnabled:!0}};case shared_1().TableEncryption.DEFAULT:return{sseSpecification:{sseEnabled:!1}};case void 0:return{sseSpecification:void 0};default:throw new(errors_1()).ValidationError(`Unexpected 'encryptionType': ${encryptionType}`,this)}}renderImportSourceSpecification(importSource){if(importSource)return{...importSource.inputFormat._render(),inputCompressionType:importSource.compressionType,s3BucketSource:{s3Bucket:importSource.bucket.bucketName,s3BucketOwner:importSource.bucketOwner,s3KeyPrefix:importSource.keyPrefix}}}static{__runInitializers(_classThis,_classExtraInitializers)}};return Table2=_classThis})();exports.Table=Table;class SourceTableAttachedPolicy extends constructs_1().Construct{grantPrincipal;policy;constructor(sourceTable,role){super(sourceTable,`SourceTableAttachedManagedPolicy-${core_1().Names.nodeUniqueId(role.node)}`);const policy=new(iam()).ManagedPolicy(this,"Resource",{description:`DynamoDB replication managed policy for table ${sourceTable.tableName}`,roles:[role]});this.policy=policy,this.grantPrincipal=new SourceTableAttachedPrincipal(role,policy)}}class SourceTableAttachedPrincipal extends iam().PrincipalBase{role;policy;constructor(role,policy){super(),this.role=role,this.policy=policy}get policyFragment(){return this.role.policyFragment}addToPrincipalPolicy(statement){return this.policy.addStatements(statement),{policyDependable:this.policy,statementAdded:!0}}dedupeString(){}}const SPECIAL_TABLE_SCHEMA_NAME="<table-schema>";
